<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Arnaud's Transformation - 6 Mois</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg-primary: #0a0e27;
            --bg-secondary: #151a35;
            --bg-card: #1a1f3a;
            --accent-fire: #ff6b35;
            --accent-success: #4ecdc4;
            --accent-warning: #ffd166;
            --accent-bulk: #a855f7;
            --text-primary: #ffffff;
            --text-secondary: #a8b2d1;
            --border: #2d3561;
            --gradient-fire: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            --gradient-success: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            --gradient-bulk: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);
            --shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* Header */
        .header {
            text-align: center;
            padding: 3rem 0;
            position: relative;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            height: 200px;
            background: radial-gradient(circle at center, rgba(255, 107, 53, 0.15) 0%, transparent 70%);
            pointer-events: none;
        }
        
        h1 {
            font-size: 3rem;
            font-weight: 900;
            background: var(--gradient-fire);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            letter-spacing: -2px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .phase-badge {
            display: inline-block;
            padding: 0.6rem 1.8rem;
            border-radius: 50px;
            font-weight: 700;
            font-size: 0.9rem;
            margin-top: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            animation: pulse 2s ease-in-out infinite;
        }
        
        .phase-cut {
            background: var(--gradient-fire);
        }
        
        .phase-transition {
            background: var(--gradient-success);
        }
        
        .phase-bulk {
            background: var(--gradient-bulk);
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* Streaks & Milestones */
        .achievements-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .achievement-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .achievement-card:hover {
            transform: translateY(-5px);
        }
        
        .achievement-icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }
        
        .achievement-title {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }
        
        .achievement-value {
            font-size: 2rem;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
            background: var(--gradient-fire);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .milestone-badge {
            display: inline-block;
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin: 0.3rem;
            background: rgba(78, 205, 196, 0.2);
            color: var(--accent-success);
        }
        
        .milestone-locked {
            background: rgba(168, 178, 209, 0.1);
            color: var(--text-secondary);
            opacity: 0.5;
        }
        
        /* Timeline */
        .timeline {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 3rem 0;
            padding: 2rem;
            background: var(--bg-card);
            border-radius: 20px;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-fire) 0%, var(--accent-success) 35%, var(--accent-bulk) 70%);
            transform: translateY(-50%);
            z-index: 0;
        }
        
        .timeline-item {
            position: relative;
            z-index: 1;
            text-align: center;
            flex: 1;
        }
        
        .timeline-dot {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--bg-card);
            border: 4px solid var(--border);
            margin: 0 auto 0.5rem;
            transition: all 0.3s ease;
        }
        
        .timeline-item.active .timeline-dot {
            width: 32px;
            height: 32px;
            border-color: var(--accent-fire);
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.6);
        }
        
        .timeline-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-weight: 600;
        }
        
        .timeline-item.active .timeline-label {
            color: var(--accent-fire);
            font-weight: 700;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 3rem 0;
        }
        
        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, var(--accent-fire) 0%, transparent 70%);
            opacity: 0.1;
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent-fire);
        }
        
        .stat-subtext {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }
        
        /* Phase Info Banner */
        .phase-info {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 2rem;
        }
        
        .phase-info-item {
            text-align: center;
        }
        
        .phase-info-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        
        .phase-info-value {
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }
        
        /* Input Section */
        .input-section {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 24px;
            padding: 2.5rem;
            margin: 2rem 0;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .section-title::before {
            content: 'üî•';
            font-size: 1.8rem;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        input[type="number"],
        input[type="date"] {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            font-size: 1.1rem;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        input:focus {
            outline: none;
            border-color: var(--accent-fire);
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }
        
        .btn {
            background: var(--gradient-fire);
            border: none;
            padding: 1.2rem 2.5rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            color: white;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(255, 107, 53, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: var(--gradient-success);
            box-shadow: 0 10px 30px rgba(78, 205, 196, 0.3);
        }
        
        .btn-secondary:hover {
            box-shadow: 0 15px 40px rgba(78, 205, 196, 0.4);
        }
        
        .btn-group {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        /* Charts */
        .chart-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .chart-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
        }
        
        canvas {
            max-height: 400px;
        }
        
        /* Goals */
        .goals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        .goal-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
        }
        
        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .goal-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
        }
        
        .goal-status {
            font-size: 0.9rem;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .status-on-track {
            background: rgba(78, 205, 196, 0.2);
            color: var(--accent-success);
        }
        
        .status-warning {
            background: rgba(255, 209, 102, 0.2);
            color: var(--accent-warning);
        }
        
        .status-danger {
            background: rgba(255, 107, 53, 0.2);
            color: var(--accent-fire);
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-secondary);
            border-radius: 10px;
            overflow: hidden;
            margin: 1rem 0;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--gradient-success);
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .goal-values {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .current-value {
            font-weight: 700;
            color: var(--accent-fire);
        }
        
        /* History Table */
        .history-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .history-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .history-table th {
            text-align: left;
            padding: 1rem;
            border-bottom: 2px solid var(--border);
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }
        
        .history-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            font-family: 'JetBrains Mono', monospace;
        }
        
        .history-table tr:hover {
            background: var(--bg-secondary);
        }
        
        .trend-up {
            color: var(--accent-success);
        }
        
        .trend-down {
            color: var(--accent-fire);
        }
        
        .edit-btn {
            background: var(--accent-warning);
            color: var(--bg-primary);
            border: none;
            padding: 0.3rem 0.8rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .edit-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(255, 209, 102, 0.4);
        }
        
        .delete-btn {
            background: var(--accent-fire);
            color: white;
            border: none;
            padding: 0.3rem 0.8rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-left: 0.5rem;
        }
        
        .delete-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.4);
        }
        
        /* Alerts */
        .alert {
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1rem 0;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 1rem;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .alert-success {
            background: rgba(78, 205, 196, 0.15);
            border: 1px solid var(--accent-success);
            color: var(--accent-success);
        }
        
        .alert-warning {
            background: rgba(255, 209, 102, 0.15);
            border: 1px solid var(--accent-warning);
            color: var(--accent-warning);
        }
        
        .alert-icon {
            font-size: 1.5rem;
        }
        
        /* Predictions */
        .prediction-card {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.1) 0%, rgba(236, 72, 153, 0.1) 100%);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .prediction-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--accent-bulk);
        }
        
        .prediction-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }
        
        .prediction-item {
            text-align: center;
        }
        
        .prediction-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }
        
        .prediction-value {
            font-size: 2rem;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
            background: var(--gradient-bulk);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 14, 39, 0.95);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 24px;
            padding: 2.5rem;
            max-width: 500px;
            width: 90%;
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--accent-fire);
        }
        
        .modal-close {
            background: var(--bg-card);
            border: 2px solid var(--border);
            padding: 0.8rem 1.5rem;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .modal-close:hover {
            border-color: var(--accent-fire);
            color: var(--text-primary);
        }
        
        /* Chart Modal */
        .chart-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 14, 39, 0.98);
            z-index: 1000;
            padding: 1rem;
            overflow-y: auto;
        }
        
        .chart-modal.active {
            display: block;
        }
        
        .chart-modal-content {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 24px;
            padding: 2rem;
            max-width: 1400px;
            min-height: 80vh;
            margin: 2rem auto;
            position: relative;
            animation: chartModalSlideIn 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        
        @keyframes chartModalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .chart-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-shrink: 0;
        }
        
        .chart-modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-fire);
        }
        
        .chart-modal-close {
            background: var(--accent-fire);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        
        .chart-modal-close:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.5);
        }
        
        .chart-modal-body {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 500px;
        }
        
        .chart-modal canvas {
            max-width: 100%;
            height: auto !important;
        }
        
        .chart-clickable {
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .chart-clickable:hover {
            transform: scale(1.02);
        }
        
        .chart-hint {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-top: 0.5rem;
            opacity: 0.7;
        }
        
        @media (max-width: 768px) {
            .chart-modal-content {
                padding: 1rem;
                margin: 0.5rem;
                border-radius: 16px;
                min-height: 90vh;
            }
            
            .chart-modal-title {
                font-size: 1.2rem;
            }
            
            .chart-modal-close {
                width: 36px;
                height: 36px;
                font-size: 1.3rem;
            }
            
            .chart-modal-body {
                min-height: 400px;
            }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .input-grid {
                grid-template-columns: 1fr;
            }
            
            .phase-info {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .timeline {
                flex-direction: column;
                gap: 1rem;
            }
            
            .container {
                padding: 1rem;
            }
            
            .achievements-container {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            /* Larger charts on mobile */
            canvas {
                max-height: 300px !important;
            }
            
            .chart-container {
                padding: 1.5rem;
            }
            
            .chart-title {
                font-size: 1.1rem;
            }
            
            /* Adjust chart aspect ratio on mobile */
            .chart-container canvas {
                height: 300px !important;
            }
        }
        
        /* ========== TABS NAVIGATION SYSTEM ========== */
        .tabs-navigation {
            display: flex;
            gap: 0.5rem;
            margin: 1.5rem 0;
            padding: 0.5rem;
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border);
            overflow-x: auto;
            scrollbar-width: thin;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        .tabs-navigation::-webkit-scrollbar {
            height: 6px;
        }
        
        .tabs-navigation::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 3px;
        }
        
        .tabs-navigation::-webkit-scrollbar-thumb {
            background: var(--accent-fire);
            border-radius: 3px;
        }
        
        .tab-button {
            flex: 1;
            min-width: 110px;
            padding: 0.9rem 1.2rem;
            background: transparent;
            border: none;
            border-radius: 12px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .tab-button:hover {
            background: rgba(255, 107, 53, 0.1);
            color: var(--text-primary);
        }
        
        .tab-button.active {
            background: var(--gradient-fire);
            color: var(--text-primary);
            box-shadow: 0 4px 20px rgba(255, 107, 53, 0.3);
        }
        
        .tab-icon {
            font-size: 1.1rem;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    
        .auto-phase-toggle{
            display:flex;
            align-items:center;
            gap:0.5rem;
            margin-top:0.75rem;
            font-size:0.9rem;
            color: var(--text-muted);
            user-select:none;
        }
        .auto-phase-toggle input{ transform: translateY(1px); }
        .btn-small{ padding: 0.45rem 0.75rem; font-size: 0.85rem; border-radius: 12px; }

</style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üî• TRANSFORMATION ARNAUD</h1>
            <p class="subtitle">Programme 6 Mois - 5 Janvier au 5 Juillet 2026</p>
            <div class="phase-badge phase-1" id="currentPhaseBadge">Phase 1: Mini-Cut üî•</div>

            <label class="auto-phase-toggle">
                <input type="checkbox" id="autoPhaseToggle">
                Auto : passer de phase quand objectifs atteints
            </label>
            <button class="btn-secondary btn-small" id="resetAutoPhaseBtn" type="button">R√©initialiser auto-phase</button>

        </div>

        <!-- ========== TABS NAVIGATION ========== -->
        <div class="tabs-navigation">
            <button class="tab-button active" onclick="switchTab('dashboard', event)">
                <span class="tab-icon">üìä</span>
                <span>Dashboard</span>
            </button>
            <button class="tab-button" onclick="switchTab('progression', event)">
                <span class="tab-icon">üìà</span>
                <span>Progression</span>
            </button>
            <button class="tab-button" onclick="switchTab('force', event)">
                <span class="tab-icon">üí™</span>
                <span>Force</span>
            </button>
            <button class="tab-button" onclick="switchTab('donnees', event)">
                <span class="tab-icon">‚úèÔ∏è</span>
                <span>Donn√©es</span>
            </button>
            <button class="tab-button" onclick="switchTab('historique', event)">
                <span class="tab-icon">üìù</span>
                <span>Historique</span>
            </button>
        </div>
        <!-- ========================================== -->
        <!-- TAB 1: DASHBOARD                           -->
        <!-- ========================================== -->
        <div id="dashboard" class="tab-content active">
            <!-- Streaks & Achievements -->
            <div class="achievements-container">
                <div class="achievement-card">
                    <div class="achievement-icon">üî•</div>
                    <div class="achievement-title">Streak Actuelle</div>
                    <div class="achievement-value" id="currentStreak">0</div>
                    <div class="stat-subtext">jours cons√©cutifs</div>
                </div>
                
                <div class="achievement-card">
                    <div class="achievement-icon">üèÜ</div>
                    <div class="achievement-title">Record Streak</div>
                    <div class="achievement-value" id="longestStreak">0</div>
                    <div class="stat-subtext">meilleur s√©rie</div>
                </div>
                
                <div class="achievement-card">
                    <div class="achievement-icon">‚≠ê</div>
                    <div class="achievement-title">Milestones</div>
                    <div id="milestonesContainer" style="margin-top: 1rem;">
                        <span class="milestone-badge milestone-locked">üéØ D√©marrage</span>
                        <span class="milestone-badge milestone-locked">üí™ -2kg</span>
                        <span class="milestone-badge milestone-locked">üî• Phase 2</span>
                        <span class="milestone-badge milestone-locked">‚ö° +5kg</span>
                        <span class="milestone-badge milestone-locked">üèÜ Objectif Final</span>
                    </div>
                </div>
            </div>

            <!-- Timeline -->
            <div class="timeline">
                <div class="timeline-item" id="timelinePhase1">
                    <div class="timeline-dot"></div>
                    <div class="timeline-label">Phase 1<br>Mini-Cut<br>5 Jan - 2 Mar</div>
                </div>
                <div class="timeline-item" id="timelinePhase2">
                    <div class="timeline-dot"></div>
                    <div class="timeline-label">Phase 2<br>Transition<br>2-15 Mar</div>
                </div>
                <div class="timeline-item" id="timelinePhase3">
                    <div class="timeline-dot"></div>
                    <div class="timeline-label">Phase 3<br>Prise de Masse<br>16 Mar - 30 Juin</div>
                </div>
            </div>

            <!-- Phase Info -->
            <div class="phase-info">
                <div class="phase-info-item">
                    <div class="phase-info-label">Objectif de Phase</div>
                    <div class="phase-info-value" id="phaseGoal">76-77kg</div>
                </div>
                <div class="phase-info-item">
                    <div class="phase-info-label">Calories Recommand√©es</div>
                    <div class="phase-info-value" id="phaseCalories">2450 kcal</div>
                    <div class="stat-subtext" id="caloriesAdjustment"></div>
                </div>
                <div class="phase-info-item">
                    <div class="phase-info-label" id="phaseDaysLabel">Jours Restants Phase</div>
                    <div class="phase-info-value" id="phaseDaysLeft">--</div>
                </div>
            </div>

            <!-- Current Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Poids Actuel</div>
                    <div class="stat-value" id="currentWeight">--</div>
                    <div class="stat-subtext">Moy. 7j: <span id="avg7days">--</span></div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Progression Totale</div>
                    <div class="stat-value" id="totalProgress">--</div>
                    <div class="stat-subtext">sur 6 mois</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Jours Total</div>
                    <div class="stat-value" id="totalDays">0</div>
                    <div class="stat-subtext">sur 194 jours</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Variation Poids</div>
                    <div class="stat-value" id="weightChange">--</div>
                    <div class="stat-subtext">depuis le d√©but</div>
                </div>
            </div>
        </div>

        <!-- ========================================== -->
        <!-- TAB 2: PROGRESSION                         -->
        <!-- ========================================== -->
        <div id="progression" class="tab-content">
            <!-- Alerts -->
            <div id="alertContainer"></div>

            <!-- Progression Analysis -->
            <div class="input-section">
                <h2 class="section-title" style="margin-bottom: 1rem;">üìä Analyse de Progression</h2>
                <div class="goals-grid">
                    <div class="goal-card">
                        <div class="goal-header">
                            <div class="goal-title">Taux de Progression</div>
                            <div class="goal-status status-on-track" id="progressionStatus">En cours</div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressionProgress" style="width: 0%"></div>
                        </div>
                        <div class="goal-values">
                            <span><span class="current-value" id="progressionRate">--</span></span>
                            <span id="progressionTarget">Objectif: --</span>
                        </div>
                    </div>
                    
                    <div class="goal-card">
                        <div class="goal-header">
                            <div class="goal-title" id="weeklyGoalTitle">Variation Hebdomadaire</div>
                            <div class="goal-status status-on-track" id="weeklyStatus">En cours</div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="weeklyProgress" style="width: 0%"></div>
                        </div>
                        <div class="goal-values">
                            <span><span class="current-value" id="weeklyChange">0.0kg</span></span>
                            <span id="weeklyTarget">Objectif: 0.4-0.5kg</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Predictions -->
            <div class="prediction-card">
                <div class="prediction-title">üîÆ Pr√©dictions Dynamiques</div>
                <div class="prediction-grid">
                    <div class="prediction-item">
                        <div class="prediction-label">Poids Pr√©vu (30 Juin)</div>
                        <div class="prediction-value" id="predictedFinalWeight">--</div>
                    </div>
                    <div class="prediction-item">
                        <div class="prediction-label">Date Objectif Phase</div>
                        <div class="prediction-value" id="predictedPhaseDate">--</div>
                    </div>
                    <div class="prediction-item">
                        <div class="prediction-label">Vitesse Actuelle</div>
                        <div class="prediction-value" id="currentRate">--</div>
                    </div>
                    <div class="prediction-item">
                        <div class="prediction-label">Jours restants</div>
                        <div class="prediction-value" id="daysToGoal">--</div>
                    </div>
                </div>
            </div>

            <!-- Main Weight Chart -->
            <div class="chart-container chart-clickable" onclick="openChartModal('main')">
                <h2 class="chart-title">üìä √âvolution Compl√®te (6 Mois)</h2>
                <canvas id="mainChart"></canvas>
                <div class="chart-hint">üëÜ Cliquer pour agrandir</div>
            </div>

            <!-- Phase Chart -->
            <div class="chart-container chart-clickable" onclick="openChartModal('phase')">
                <h2 class="chart-title">üéØ Zoom Phase Actuelle</h2>
                <canvas id="phaseChart"></canvas>
                <div class="chart-hint">üëÜ Cliquer pour agrandir</div>
            </div>
        </div>

        <!-- ========================================== -->
        <!-- TAB 3: FORCE                               -->
        <!-- ========================================== -->
        <div id="force" class="tab-content">
            <!-- Strength Tracking -->
            <div class="input-section">
                <h2 class="section-title">üí™ Progression Force</h2>
                <div class="input-grid">
                    <div class="input-group">
                        <label>Squat (kg)</label>
                        <input type="number" id="squat" placeholder="60" step="2.5">
                    </div>
                    <div class="input-group">
                        <label>D√©velopp√© Inclin√© (kg)</label>
                        <input type="number" id="bench" placeholder="55" step="2.5">
                    </div>
                    <div class="input-group">
                        <label>Soulev√© de Terre (kg)</label>
                        <input type="number" id="deadlift" placeholder="50" step="2.5">
                    </div>
                    <div class="input-group">
                        <label>Presse Convergente (kg)</label>
                        <input type="number" id="press" placeholder="66" step="2.5">
                    </div>
                </div>
                <br>
                <button class="btn" onclick="saveStrength()">üí™ Enregistrer les Charges</button>
            </div>

            <!-- Strength Chart -->
            <div class="chart-container chart-clickable" onclick="openChartModal('strength')">
                <h2 class="chart-title">üìà √âvolution des Charges</h2>
                <canvas id="strengthChart"></canvas>
                <div class="chart-hint">üëÜ Cliquer pour agrandir</div>
            </div>
        </div>

        <!-- ========================================== -->
        <!-- TAB 4: DONN√âES                             -->
        <!-- ========================================== -->
        <div id="donnees" class="tab-content">
            <!-- Daily Input -->
            <div class="input-section">
                <h2 class="section-title">Enregistrer Aujourd'hui</h2>
                <div class="input-grid">
                    <div class="input-group">
                        <label for="date">Date</label>
                        <input type="date" id="date" required>
                    </div>
                    <div class="input-group">
                        <label for="weight">Poids (kg)</label>
                        <input type="number" id="weight" step="0.1" placeholder="80.0" required>
                    </div>
                    <div class="input-group">
                        <label for="waist">Tour de Taille (cm)</label>
                        <input type="number" id="waist" step="0.5" placeholder="85.0">
                    </div>
                </div>
                <input type="hidden" id="editingDate" value="">
                <div class="btn-group">
                    <button class="btn" onclick="saveEntry()">üíæ <span id="saveButtonText">Enregistrer</span></button>
                    <button class="btn btn-secondary" onclick="exportData()">üì• Exporter</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">üì§ Importer</button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                </div>
            </div>
        </div>

        <!-- ========================================== -->
        <!-- TAB 5: HISTORIQUE                          -->
        <!-- ========================================== -->
        <div id="historique" class="tab-content">
            <!-- History Table -->
            <div class="history-container">
                <h2 class="chart-title">üìù Historique Complet</h2>
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Phase</th>
                            <th>Poids</th>
                            <th>Moy. 7j</th>
                            <th>Variation</th>
                            <th>Tour de Taille</th>
                            <th>Calories</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="historyBody">
                        <tr>
                            <td colspan="8" style="text-align: center; color: var(--text-secondary);">Aucune donn√©e enregistr√©e</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>


    <!-- ========================================== -->
    <!-- MODALS                                     -->
    <!-- ========================================== -->
    <!-- Edit Modal -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <h2 class="modal-header">Modifier l'entr√©e</h2>
            <div class="input-grid">
                <div class="input-group">
                    <label>Poids (kg)</label>
                    <input type="number" id="editWeight" step="0.1">
                </div>
                <div class="input-group">
                    <label>Tour de Taille (cm)</label>
                    <input type="number" id="editWaist" step="0.5">
                </div>
            </div>
            <div class="btn-group">
                <button class="btn" onclick="saveEdit()">‚úÖ Mettre √† jour</button>
                <button class="btn btn-secondary" onclick="closeEditModal()">‚ùå Annuler</button>
            </div>
        </div>
    </div>

    <!-- Chart Modal -->
    <div class="chart-modal" id="chartModal">
        <div class="chart-modal-content">
            <div class="chart-modal-header">
                <h2 class="chart-modal-title" id="modalChartTitle">Graphique</h2>
                <button class="chart-modal-close" onclick="closeChartModal()">‚úï</button>
            </div>
            <canvas id="modalChart"></canvas>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- JAVASCRIPT                                 -->
    <!-- ========================================== -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // ========== TAB SWITCHING FUNCTION ==========
        function switchTab(tabName, evt) {
            const e = evt || window.event;

            // Update buttons
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            const clickedBtn =
                (e && e.currentTarget) ||
                (e && e.target && e.target.closest ? e.target.closest('.tab-button') : null);

            if (clickedBtn) {
                clickedBtn.classList.add('active');
            } else {
                // Fallback: highlight the first button that points to this tabName
                const fallback = document.querySelector(`.tab-button[onclick*="'${tabName}'"]`);
                if (fallback) fallback.classList.add('active');
            }

            // Update content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            const tabEl = document.getElementById(tabName);
            if (tabEl) tabEl.classList.add('active');

            // Re-render charts if needed
            if (tabName === 'progression') {
                setTimeout(() => {
                    if (window.mainChartInstance) window.mainChartInstance.update();
                    if (window.phaseChartInstance) window.phaseChartInstance.update();
                }, 100);
            } else if (tabName === 'force') {
                setTimeout(() => {
                    if (window.strengthChartInstance) window.strengthChartInstance.update();
                }, 100);
            }
        }
    </script>
    <script>
        // Phase Configuration
        const PHASES = {
            PRESTART: {
                name: 'Pr√©paration',
                start: new Date('2025-12-19'),
                end: new Date('2026-01-05'),
                startWeight: 80,
                targetWeight: 80,
                weeklyTarget: 0,
                caloriesBase: 0,
                badge: 'phase-cut'
            },
            PHASE1: {
                name: 'Phase 1 : Mini-Cut',
                start: new Date('2026-01-05'),
                end: new Date('2026-03-02'),
                startWeight: 80,
                targetWeight: 76.5,
                // Objectif tour de taille (cm). Mets une valeur si tu veux que l‚Äôauto-phase exige aussi la taille.
                targetWaist: null,
                // 'max' = taille doit √™tre <= targetWaist. 'min' = taille doit √™tre >= targetWaist.
                waistGoalType: 'max',
                weeklyTarget: -0.45,
                caloriesBase: 2400,
                caloriesWeeks: [
                    {week: 0, calories: 2400},
                    {week: 2, calories: 2400},
                    {week: 4, calories: 2450},
                    {week: 6, calories: 2500}
                ],
                badge: 'phase-cut'
            },
            PHASE2: {
                name: 'Phase 2 : Transition',
                start: new Date('2026-03-02'),
                end: new Date('2026-03-16'),
                startWeight: 76.5,
                targetWeight: 77,
                weeklyTarget: 0.25,
                caloriesBase: 2750,
                caloriesWeeks: [
                    {week: 0, calories: 2700},
                    {week: 1, calories: 2850}
                ],
                badge: 'phase-transition'
            },
            PHASE3: {
                name: 'Phase 3 : Prise de Masse',
                start: new Date('2026-03-16'),
                end: new Date('2026-06-30'),
                startWeight: 77,
                targetWeight: 85.5,
                weeklyTarget: 0.30,
                caloriesBase: 3050,
                caloriesWeeks: [
                    {week: 0, calories: 3000},
                    {week: 8, calories: 3100}
                ],
                badge: 'phase-bulk'
            }
        };

        // Milestones configuration
        const MILESTONES = [
            { id: 'start', name: 'üéØ D√©marrage', condition: (data) => data.length > 0 },
            { id: 'minus2', name: 'üí™ -2kg', condition: (data) => {
                if (data.length === 0) return false;
                const latest = data[data.length - 1];
                return latest.weight <= 78;
            }},
            { id: 'phase2', name: 'üî• Phase 2', condition: (data) => {
                if (data.length === 0) return false;
                const latest = data[data.length - 1];
                return new Date(latest.date) >= PHASES.PHASE2.start;
            }},
            { id: 'plus5', name: '‚ö° +5kg', condition: (data) => {
                if (data.length === 0) return false;
                const latest = data[data.length - 1];
                return latest.weight >= 85;
            }},
            { id: 'final', name: 'üèÜ Objectif Final', condition: (data) => {
                if (data.length === 0) return false;
                const latest = data[data.length - 1];
                return latest.weight >= 85.5 && new Date(latest.date) >= new Date('2026-06-30');
            }}
        ];

        // Data storage
        let weightData = JSON.parse(localStorage.getItem('weightData')) || [];
        let strengthData = JSON.parse(localStorage.getItem('strengthData')) || [];
        
        // Set today's date
        document.getElementById('date').valueAsDate = new Date();
        // Auto-phase UI (persist√© en localStorage)
        window.addEventListener('DOMContentLoaded', () => {
            const toggle = document.getElementById('autoPhaseToggle');
            const resetBtn = document.getElementById('resetAutoPhaseBtn');
            if (!toggle || !resetBtn) return;

            toggle.checked = isAutoPhaseEnabled();

            toggle.addEventListener('change', () => {
                setAutoPhaseEnabled(toggle.checked);
                updateAll();
            });

            resetBtn.addEventListener('click', () => {
                // R√©initialise le lock et les dates effectives (utile si tu veux "revenir" √† la logique date / refaire un cycle)
                localStorage.removeItem(getPhaseLockKey());
                localStorage.removeItem(getPhaseEffectiveStartKey('PHASE2'));
                localStorage.removeItem(getPhaseEffectiveStartKey('PHASE3'));
                updateAll();
            });
        });

        
        const TEST_DATE = null;
        
        // Notification scheduling
        function requestNotificationPermission() {
            if ('Notification' in window && 'serviceWorker' in navigator) {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        scheduleNotification();
                    }
                });
            }
        }
        
        function scheduleNotification() {
            // Schedule daily notification at 8 AM
            const now = new Date();
            const scheduledTime = new Date();
            scheduledTime.setHours(8, 0, 0, 0);
            
            if (scheduledTime <= now) {
                scheduledTime.setDate(scheduledTime.getDate() + 1);
            }
            
            const timeUntilNotification = scheduledTime - now;
            
            setTimeout(() => {
                showNotification();
                // Schedule next day
                setInterval(showNotification, 24 * 60 * 60 * 1000);
            }, timeUntilNotification);
        }
        
        function showNotification() {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('üî• Transformation Tracker', {
                    body: 'N\'oublie pas de te peser aujourd\'hui !',
                    icon: 'üî•',
                    badge: 'üî•'
                });
            }
        }
        
        // Request permission on load
        window.addEventListener('load', () => {
            if ('Notification' in window && Notification.permission === 'default') {
                setTimeout(requestNotificationPermission, 3000);
            }
        });
        
        // Get current phase
        
        const PHASE_ORDER = ['PHASE1', 'PHASE2', 'PHASE3'];
        const PHASE_RANK = { PRESTART: 0, PHASE1: 1, PHASE2: 2, PHASE3: 3 };

        function phaseRank(key) {
            return PHASE_RANK[key] ?? 0;
        }

        // Date-based phase (ne change PAS avec les objectifs, utile pour l‚Äôhistorique)
        function getPhaseByDate(date = null) {
            if (date === null) {
                date = TEST_DATE || new Date();
            }

            if (date < PHASES.PRESTART.start) {
                return PHASES.PRESTART;
            }

            if (date >= PHASES.PRESTART.start && date < PHASES.PHASE1.start) {
                return PHASES.PRESTART;
            }

            if (date >= PHASES.PHASE1.start && date < PHASES.PHASE2.start) {
                return PHASES.PHASE1;
            }

            if (date >= PHASES.PHASE2.start && date < PHASES.PHASE3.start) {
                return PHASES.PHASE2;
            }

            if (date >= PHASES.PHASE3.start && date <= PHASES.PHASE3.end) {
                return PHASES.PHASE3;
            }

            return PHASES.PHASE3;
        }

        function getPhaseKeyByDate(date = null) {
            const d = date ? new Date(date) : (TEST_DATE || new Date());
            if (d < PHASES.PRESTART.start) return 'PRESTART';
            if (d < PHASES.PHASE1.start) return 'PRESTART';
            if (d < PHASES.PHASE2.start) return 'PHASE1';
            if (d < PHASES.PHASE3.start) return 'PHASE2';
            return 'PHASE3';
        }

        function isAutoPhaseEnabled() {
            const v = localStorage.getItem('autoAdvancePhases');
            return (v === null) ? true : (v === '1');
        }

        function setAutoPhaseEnabled(enabled) {
            localStorage.setItem('autoAdvancePhases', enabled ? '1' : '0');
        }

        function getLatestEntry() {
            if (!Array.isArray(weightData) || weightData.length === 0) return null;
            const sorted = [...weightData].sort((a, b) => new Date(a.date) - new Date(b.date));
            return sorted[sorted.length - 1] || null;
        }

        function isPhaseGoalMet(phaseKey, latest) {
            const phase = PHASES[phaseKey];
            if (!phase || !latest || typeof latest.weight !== 'number') return false;

            const weightTol = 0.2; // kg
            const waistTol = 0.5;  // cm

            const targetW = phase.targetWeight;
            let weightMet = true;

            if (typeof targetW === 'number') {
                if (phase.weeklyTarget < 0) {
                    weightMet = latest.weight <= (targetW + weightTol);
                } else if (phase.weeklyTarget > 0) {
                    weightMet = latest.weight >= (targetW - weightTol);
                } else {
                    weightMet = Math.abs(latest.weight - targetW) <= weightTol;
                }
            }

            // Tour de taille : uniquement si targetWaist est renseign√©
            let waistMet = true;
            if (typeof phase.targetWaist === 'number') {
                if (typeof latest.waist !== 'number') {
                    waistMet = false;
                } else if (phase.waistGoalType === 'min') {
                    waistMet = latest.waist >= (phase.targetWaist - waistTol);
                } else {
                    // par d√©faut : 'max'
                    waistMet = latest.waist <= (phase.targetWaist + waistTol);
                }
            }

            return weightMet && waistMet;
        }

        function getPhaseLockKey() {
            return 'phaseLock';
        }

        function getPhaseEffectiveStartKey(phaseKey) {
            return 'phaseEffectiveStart_' + phaseKey;
        }

        function getPhaseEffectiveStart(phaseKey) {
            const planned = PHASES[phaseKey]?.start || (TEST_DATE || new Date());
            const stored = localStorage.getItem(getPhaseEffectiveStartKey(phaseKey));
            if (!stored) return planned;

            const sd = new Date(stored);
            if (isNaN(sd.getTime())) return planned;

            // on ne garde l‚Äôeffectif que s‚Äôil est AVANT la date planifi√©e (cas "avance")
            return (sd < planned) ? sd : planned;
        }

        function setPhaseEffectiveStartIfMissing(phaseKey, whenDate) {
            const k = getPhaseEffectiveStartKey(phaseKey);
            if (localStorage.getItem(k)) return;
            const d = whenDate ? new Date(whenDate) : (TEST_DATE || new Date());
            localStorage.setItem(k, d.toISOString());
        }

        function getLockedPhaseKey(datePhaseKey) {
            const lockKey = getPhaseLockKey();
            const stored = localStorage.getItem(lockKey);
            if (!stored) {
                localStorage.setItem(lockKey, datePhaseKey);
                return datePhaseKey;
            }
            // pas de retour en arri√®re
            if (phaseRank(datePhaseKey) > phaseRank(stored)) {
                localStorage.setItem(lockKey, datePhaseKey);
                return datePhaseKey;
            }
            return stored;
        }

        function maybeAdvancePhaseLockFromGoals(today = null) {
            const now = today ? new Date(today) : (TEST_DATE || new Date());
            const dateKey = getPhaseKeyByDate(now);
            let lockKey = getLockedPhaseKey(dateKey);

            if (!isAutoPhaseEnabled()) return lockKey;

            // avant le d√©but du programme, on ne "saute" rien
            if (now < PHASES.PHASE1.start) return lockKey;

            const latest = getLatestEntry();
            if (!latest) return lockKey;

            // Tant qu‚Äôune phase est valid√©e, on avance (une seule fois) et on lock
            if (lockKey === 'PHASE1' && isPhaseGoalMet('PHASE1', latest)) {
                lockKey = 'PHASE2';
                localStorage.setItem(getPhaseLockKey(), lockKey);
                if (now < PHASES.PHASE2.start) setPhaseEffectiveStartIfMissing('PHASE2', now);
            }

            if (lockKey === 'PHASE2' && isPhaseGoalMet('PHASE2', latest)) {
                lockKey = 'PHASE3';
                localStorage.setItem(getPhaseLockKey(), lockKey);
                if (now < PHASES.PHASE3.start) setPhaseEffectiveStartIfMissing('PHASE3', now);
            }

            return lockKey;
        }

        function getActivePhaseKey(date = null) {
            const now = date ? new Date(date) : (TEST_DATE || new Date());
            const dateKey = getPhaseKeyByDate(now);
            const locked = maybeAdvancePhaseLockFromGoals(now);
            // Si la date est d√©j√† plus loin, elle prime (et met √† jour le lock)
            return (phaseRank(dateKey) > phaseRank(locked)) ? dateKey : locked;
        }

        // Phase active : peut avancer plus t√¥t si objectifs atteints (et lock pour √©viter les retours)
        function getActivePhase(date = null) {
            const key = getActivePhaseKey(date);
            return PHASES[key] || PHASES.PRESTART;
        }

        // Compat : si on passe une date, on veut la phase "historique" bas√©e sur la date.
        function getCurrentPhase(date = null) {
            if (date !== null) return getPhaseByDate(date);
            return getActivePhase();
        }


        // Get phase for a specific date
        function getPhaseForDate(date) {
            const d = new Date(date);
            if (d < PHASES.PRESTART.start) return 'Avant tracking';
            if (d < PHASES.PHASE1.start) return 'Pr√©paration';
            if (d < PHASES.PHASE2.start) return 'Phase 1';
            if (d < PHASES.PHASE3.start) return 'Phase 2';
            return 'Phase 3';
        }
        
        // Get target calories for date
        function getTargetCalories(date) {
            const phase = getPhaseByDate(date);
            
            if (phase === PHASES.PRESTART) {
                return 0;
            }
            
            const weekInPhase = Math.floor((date - phase.start) / (1000 * 60 * 60 * 24 * 7));
            
            let calories = phase.caloriesBase;
            for (let i = phase.caloriesWeeks.length - 1; i >= 0; i--) {
                if (weekInPhase >= phase.caloriesWeeks[i].week) {
                    calories = phase.caloriesWeeks[i].calories;
                    break;
                }
            }
            return calories;
        }
        
        // Calories bas√©es sur la phase active (auto-phase possible) + "date de d√©part effective" si on a avanc√© plus t√¥t
        function getTargetCaloriesForActivePhase(date = null) {
            const d = date ? new Date(date) : (TEST_DATE || new Date());
            const phaseKey = getActivePhaseKey(d);

            if (phaseKey === 'PRESTART') return 0;

            const phase = PHASES[phaseKey];
            const effectiveStart = getPhaseEffectiveStart(phaseKey);

            const weekInPhase = Math.floor((d - effectiveStart) / (1000 * 60 * 60 * 24 * 7));

            let calories = phase.caloriesBase;
            for (let i = phase.caloriesWeeks.length - 1; i >= 0; i--) {
                if (weekInPhase >= phase.caloriesWeeks[i].week) {
                    calories = phase.caloriesWeeks[i].calories;
                    break;
                }
            }
            return calories;
        }


        // Calculate adjusted calories based on progression
        function getAdjustedCalories() {
            if (weightData.length < 7) {
                return { calories: getTargetCaloriesForActivePhase(new Date()), adjustment: 0, message: '' };
            }
            
            const currentPhase = getCurrentPhase();
            const last7Days = weightData.slice(-7);
            const weightChange = last7Days[last7Days.length - 1].weight - last7Days[0].weight;
            const target = currentPhase.weeklyTarget;
            const baseCalories = getTargetCaloriesForActivePhase(new Date());
            
            let adjustment = 0;
            let message = '';
            
            if (currentPhase === PHASES.PHASE1) {
                // Mini-cut: losing weight
                if (weightChange > -0.3) {
                    adjustment = -100;
                    message = 'Perte trop lente : -100 kcal';
                } else if (weightChange < -0.6) {
                    adjustment = +100;
                    message = 'Perte trop rapide : +100 kcal';
                } else {
                    message = 'Progression parfaite ‚úì';
                }
            } else if (currentPhase === PHASES.PHASE2) {
                // Transition: maintenance
                if (Math.abs(weightChange) > 0.3) {
                    adjustment = weightChange > 0 ? -50 : +50;
                    message = `Ajustement : ${adjustment > 0 ? '+' : ''}${adjustment} kcal`;
                } else {
                    message = 'Maintien parfait ‚úì';
                }
            } else if (currentPhase === PHASES.PHASE3) {
                // Bulk: gaining weight
                if (weightChange < 0.2) {
                    adjustment = +100;
                    message = 'Gain trop lent : +100 kcal';
                } else if (weightChange > 0.4) {
                    adjustment = -100;
                    message = 'Gain trop rapide : -100 kcal';
                } else {
                    message = 'Progression parfaite ‚úì';
                }
            }
            
            return {
                calories: baseCalories + adjustment,
                adjustment: adjustment,
                message: message
            };
        }
        
        // Calculate 7-day moving average
        function get7DayAverage(upToIndex = null) {
            if (weightData.length === 0) return null;
            
            const index = upToIndex !== null ? upToIndex : weightData.length - 1;
            const start = Math.max(0, index - 6);
            const slice = weightData.slice(start, index + 1);
            
            if (slice.length === 0) return null;
            
            const sum = slice.reduce((acc, entry) => acc + entry.weight, 0);
            return sum / slice.length;
        }
        
        // Calculate streak
        function calculateStreak() {
            if (weightData.length === 0) return { current: 0, longest: 0 };
            
            let currentStreak = 0;
            let longestStreak = 0;
            let tempStreak = 1;
            
            const sortedData = [...weightData].sort((a, b) => new Date(a.date) - new Date(b.date));
            
            for (let i = 1; i < sortedData.length; i++) {
                const prevDate = new Date(sortedData[i - 1].date);
                const currDate = new Date(sortedData[i].date);
                const diffDays = Math.floor((currDate - prevDate) / (1000 * 60 * 60 * 24));
                
                if (diffDays === 1) {
                    tempStreak++;
                } else {
                    longestStreak = Math.max(longestStreak, tempStreak);
                    tempStreak = 1;
                }
            }
            
            longestStreak = Math.max(longestStreak, tempStreak);
            
            // Calculate current streak
            const today = new Date();
            const lastEntry = new Date(sortedData[sortedData.length - 1].date);
            const daysSinceLastEntry = Math.floor((today - lastEntry) / (1000 * 60 * 60 * 24));
            
            if (daysSinceLastEntry <= 1) {
                currentStreak = tempStreak;
            } else {
                currentStreak = 0;
            }
            
            return { current: currentStreak, longest: longestStreak };
        }
        
        // Update milestones
        function updateMilestones() {
            const container = document.getElementById('milestonesContainer');
            container.innerHTML = '';
            
            MILESTONES.forEach(milestone => {
                const badge = document.createElement('span');
                badge.className = 'milestone-badge';
                
                if (milestone.condition(weightData)) {
                    badge.textContent = milestone.name;
                } else {
                    badge.textContent = milestone.name;
                    badge.classList.add('milestone-locked');
                }
                
                container.appendChild(badge);
            });
        }
        
        // Dynamic predictions
        function calculatePredictions() {
            if (weightData.length < 7) {
                return {
                    finalWeight: 'Pas assez de donn√©es',
                    phaseDate: '--',
                    rate: '--',
                    daysToGoal: '--'
                };
            }
            
            const currentPhase = getCurrentPhase();
            const recent = weightData.slice(-14);
            
            // Calculate current rate (kg/week)
            const firstDate = new Date(recent[0].date);
            const lastDate = new Date(recent[recent.length - 1].date);
            const weeks = (lastDate - firstDate) / (1000 * 60 * 60 * 24 * 7);
            const weightChange = recent[recent.length - 1].weight - recent[0].weight;
            const rate = weightChange / weeks;
            
            // Predict final weight (30 June)
            const today = new Date();
            const endDate = PHASES.PHASE3.end;
            const weeksRemaining = (endDate - today) / (1000 * 60 * 60 * 24 * 7);
            const currentWeight = weightData[weightData.length - 1].weight;
            const predictedFinal = currentWeight + (rate * weeksRemaining);
            
            // Predict when we'll reach phase goal
            const phaseGoalWeight = currentPhase.targetWeight;
            const weightToGo = phaseGoalWeight - currentWeight;
            const weeksToGoal = rate !== 0 ? weightToGo / rate : 0;
            const daysToGoal = Math.round(weeksToGoal * 7);
            const predictedDate = new Date(today.getTime() + daysToGoal * 24 * 60 * 60 * 1000);
            
            return {
                finalWeight: predictedFinal.toFixed(1) + 'kg',
                phaseDate: daysToGoal > 0 ? predictedDate.toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' }) : 'Atteint',
                rate: (rate >= 0 ? '+' : '') + rate.toFixed(2) + 'kg/sem',
                daysToGoal: daysToGoal > 0 ? daysToGoal + 'j' : 'Atteint'
            };
        }
        
        // Get expected weight for date
        function getExpectedWeight(date) {
            let weight = PHASES.PHASE1.startWeight;
            const d = new Date(date);
            
            if (d >= PHASES.PHASE1.start && d <= PHASES.PHASE1.end) {
                const weeks = (d - PHASES.PHASE1.start) / (1000 * 60 * 60 * 24 * 7);
                weight = PHASES.PHASE1.startWeight + (weeks * PHASES.PHASE1.weeklyTarget);
            }
            else if (d >= PHASES.PHASE2.start && d <= PHASES.PHASE2.end) {
                weight = PHASES.PHASE1.targetWeight;
                const weeks = (d - PHASES.PHASE2.start) / (1000 * 60 * 60 * 24 * 7);
                weight += (weeks * PHASES.PHASE2.weeklyTarget);
            }
            else if (d >= PHASES.PHASE3.start) {
                weight = PHASES.PHASE2.targetWeight;
                const weeks = Math.min(
                    (d - PHASES.PHASE3.start) / (1000 * 60 * 60 * 24 * 7),
                    (PHASES.PHASE3.end - PHASES.PHASE3.start) / (1000 * 60 * 60 * 24 * 7)
                );
                weight += (weeks * PHASES.PHASE3.weeklyTarget);
            }
            
            return weight;
        }
        
        // Calculate total days elapsed
        function getTotalDaysElapsed() {
            const today = TEST_DATE || new Date();
            const start = PHASES.PRESTART.start;
            return Math.max(0, Math.floor((today - start) / (1000 * 60 * 60 * 24)));
        }
        
        // Update phase UI
        function updatePhaseUI() {
            const currentPhase = getCurrentPhase();
            const today = TEST_DATE || new Date();
            
            const isPreStart = currentPhase === PHASES.PRESTART;
            
            const badge = document.getElementById('currentPhaseBadge');
            if (isPreStart) {
                badge.textContent = 'üìä P√©riode de Suivi Pr√©-D√©marrage';
                badge.className = 'phase-badge phase-cut';
                badge.style.opacity = '0.8';
            } else {
                badge.textContent = currentPhase.name;
                badge.className = 'phase-badge ' + currentPhase.badge;
                badge.style.opacity = '1';
            }
            
            document.getElementById('timelinePhase1').classList.remove('active');
            document.getElementById('timelinePhase2').classList.remove('active');
            document.getElementById('timelinePhase3').classList.remove('active');
            
            if (!isPreStart) {
                if (currentPhase === PHASES.PHASE1) {
                    document.getElementById('timelinePhase1').classList.add('active');
                } else if (currentPhase === PHASES.PHASE2) {
                    document.getElementById('timelinePhase2').classList.add('active');
                } else {
                    document.getElementById('timelinePhase3').classList.add('active');
                }
            }
            
            if (isPreStart) {
                const daysUntilStart = Math.ceil((PHASES.PHASE1.start - today) / (1000 * 60 * 60 * 24));
                document.getElementById('phaseGoal').textContent = 'Tracking Poids';
                document.getElementById('phaseCalories').textContent = 'Libre';
                document.getElementById('caloriesAdjustment').textContent = '';
                document.getElementById('phaseDaysLabel').textContent = 'Jours Avant Phase 1';
                document.getElementById('phaseDaysLeft').textContent = daysUntilStart;
            } else {
                document.getElementById('phaseGoal').textContent = (() => {
                    // Affichage dynamique : poids + (optionnel) tour de taille
                    const phaseKey = getActivePhaseKey();
                    if (phaseKey === 'PRESTART') return 'Tracking Poids';
                    const phase = PHASES[phaseKey];
                    const parts = [];
                    if (typeof phase.targetWeight === 'number') parts.push('Poids: ' + phase.targetWeight.toFixed(1) + ' kg');
                    if (typeof phase.targetWaist === 'number') {
                        const op = (phase.waistGoalType === 'min') ? '‚â•' : '‚â§';
                        parts.push('Taille: ' + op + ' ' + phase.targetWaist.toFixed(1) + ' cm');
                    }
                    return parts.join(' ‚Ä¢ ') || 'Objectif';
                })();
                
                const adjustedCals = getAdjustedCalories();
                document.getElementById('phaseCalories').textContent = adjustedCals.calories + ' kcal';
                document.getElementById('caloriesAdjustment').textContent = adjustedCals.message;
                
                document.getElementById('phaseDaysLabel').textContent = 'Jours Restants Phase';
                const daysLeft = Math.ceil((currentPhase.end - today) / (1000 * 60 * 60 * 24));
                document.getElementById('phaseDaysLeft').textContent = Math.max(0, daysLeft);
            }
            
            if (currentPhase === PHASES.PHASE1) {
                document.getElementById('weeklyGoalTitle').textContent = 'Perte Hebdomadaire';
                document.getElementById('weeklyTarget').textContent = 'Objectif: -0.4 √† -0.5kg';
            } else if (currentPhase === PHASES.PHASE2) {
                document.getElementById('weeklyGoalTitle').textContent = 'Maintien';
                document.getElementById('weeklyTarget').textContent = 'Objectif: ¬±0.2kg';
            } else {
                document.getElementById('weeklyGoalTitle').textContent = 'Gain Hebdomadaire';
                document.getElementById('weeklyTarget').textContent = 'Objectif: +0.25 √† +0.35kg';
            }
        }
        
        // Export data
        function exportData() {
            const data = {
                weightData: weightData,
                strengthData: strengthData,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `transformation-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showAlert('‚úÖ Donn√©es export√©es avec succ√®s !', 'success');
        }
        
        // Import data
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.weightData && Array.isArray(data.weightData)) {
                        weightData = data.weightData;
                        localStorage.setItem('weightData', JSON.stringify(weightData));
                    }
                    
                    if (data.strengthData && Array.isArray(data.strengthData)) {
                        strengthData = data.strengthData;
                        localStorage.setItem('strengthData', JSON.stringify(strengthData));
                    }
                    
                    showAlert('‚úÖ Donn√©es import√©es avec succ√®s !', 'success');
                    updateDashboard();
                } catch (error) {
                    showAlert('‚ö†Ô∏è Erreur lors de l\'import. Fichier invalide.', 'warning');
                }
            };
            reader.readAsText(file);
        }
        
        // Edit entry
        function editEntry(date) {
            const entry = weightData.find(e => e.date === date);
            if (!entry) return;
            
            document.getElementById('editingDate').value = date;
            document.getElementById('editWeight').value = entry.weight;
            document.getElementById('editWaist').value = entry.waist || '';
            document.getElementById('editModal').classList.add('active');
        }
        
        // Save edit
        function saveEdit() {
            const date = document.getElementById('editingDate').value;
            const weight = parseFloat(document.getElementById('editWeight').value);
            const waist = parseFloat(document.getElementById('editWaist').value);
            
            const entryIndex = weightData.findIndex(e => e.date === date);
            if (entryIndex === -1) return;
            
            weightData[entryIndex].weight = weight;
            weightData[entryIndex].waist = waist || null;
            
            localStorage.setItem('weightData', JSON.stringify(weightData));
            
            closeEditModal();
            showAlert('‚úÖ Entr√©e modifi√©e avec succ√®s !', 'success');
            updateDashboard();
        }
        
        // Close edit modal
        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
            document.getElementById('editingDate').value = '';
            document.getElementById('editWeight').value = '';
            document.getElementById('editWaist').value = '';
        }
        
        // Delete entry
        function deleteEntry(date) {
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer cette entr√©e ?')) return;
            
            weightData = weightData.filter(e => e.date !== date);
            localStorage.setItem('weightData', JSON.stringify(weightData));
            
            showAlert('‚úÖ Entr√©e supprim√©e', 'success');
            updateDashboard();
        }
        
        // Save entry
        function saveEntry() {
            const date = document.getElementById('date').value;
            const weight = parseFloat(document.getElementById('weight').value);
            const waist = parseFloat(document.getElementById('waist').value);
            
            if (!date || !weight) {
                showAlert('‚ö†Ô∏è Veuillez remplir au moins la date et le poids', 'warning');
                return;
            }
            
            const entryDate = new Date(date);
            if (entryDate < PHASES.PRESTART.start) {
                showAlert('‚ö†Ô∏è Le tracking commence le 19 d√©cembre 2025', 'warning');
                return;
            }
            
            const selectedDate = new Date(date);
            const today = TEST_DATE || new Date();
            const isToday = selectedDate.toDateString() === today.toDateString();
            const calories = isToday ? getTargetCaloriesForActivePhase(selectedDate) : getTargetCalories(selectedDate);
            
            const entry = {
                date: date,
                weight: weight,
                waist: waist || null,
                calories: calories,
                phase: getPhaseForDate(date)
            };
            
            weightData = weightData.filter(e => e.date !== date);
            weightData.push(entry);
            weightData.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            localStorage.setItem('weightData', JSON.stringify(weightData));
            
            showAlert('‚úÖ Donn√©es enregistr√©es avec succ√®s !', 'success');
            updateDashboard();
            
            document.getElementById('weight').value = '';
            document.getElementById('waist').value = '';
        }
        
        // Save strength
        function saveStrength() {
            const date = document.getElementById('date').value;
            const squat = parseFloat(document.getElementById('squat').value);
            const bench = parseFloat(document.getElementById('bench').value);
            const deadlift = parseFloat(document.getElementById('deadlift').value);
            const press = parseFloat(document.getElementById('press').value);
            
            if (!date) {
                showAlert('‚ö†Ô∏è Veuillez s√©lectionner une date', 'warning');
                return;
            }
            
            const entry = {
                date: date,
                squat: squat || null,
                bench: bench || null,
                deadlift: deadlift || null,
                press: press || null
            };
            
            strengthData = strengthData.filter(e => e.date !== date);
            strengthData.push(entry);
            strengthData.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            localStorage.setItem('strengthData', JSON.stringify(strengthData));
            
            showAlert('üí™ Charges enregistr√©es avec succ√®s !', 'success');
            updateStrengthChart();
            
            document.getElementById('squat').value = '';
            document.getElementById('bench').value = '';
            document.getElementById('deadlift').value = '';
            document.getElementById('press').value = '';
        }
        
        // Show alert
        function showAlert(message, type) {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <span class="alert-icon">${type === 'success' ? '‚úÖ' : '‚ö†Ô∏è'}</span>
                <span>${message}</span>
            `;
            container.innerHTML = '';
            container.appendChild(alert);
            
            setTimeout(() => {
                alert.style.opacity = '0';
                setTimeout(() => alert.remove(), 300);
            }, 4000);
        }
        
        // Update dashboard
        function updateDashboard() {
            updatePhaseUI();
            
            const totalDays = getTotalDaysElapsed();
            document.getElementById('totalDays').textContent = totalDays;
            
            // Update streaks
            const streaks = calculateStreak();
            document.getElementById('currentStreak').textContent = streaks.current;
            document.getElementById('longestStreak').textContent = streaks.longest;
            
            // Update milestones
            updateMilestones();
            
            if (weightData.length > 0) {
                const latestEntry = weightData[weightData.length - 1];
                const currentWeight = latestEntry.weight;
                document.getElementById('currentWeight').textContent = currentWeight.toFixed(1) + 'kg';
                
                // 7-day average
                const avg7 = get7DayAverage();
                if (avg7) {
                    document.getElementById('avg7days').textContent = avg7.toFixed(1) + 'kg';
                }
                
                const weightChange = currentWeight - PHASES.PHASE1.startWeight;
                const changeText = weightChange >= 0 ? '+' + weightChange.toFixed(1) : weightChange.toFixed(1);
                document.getElementById('weightChange').textContent = changeText + 'kg';
                
                const progressPercent = ((currentWeight - PHASES.PHASE1.startWeight) / (PHASES.PHASE3.targetWeight - PHASES.PHASE1.startWeight) * 100).toFixed(1);
                document.getElementById('totalProgress').textContent = progressPercent + '%';
                
                // Progression rate
                const currentPhase = getCurrentPhase();
                const expectedWeight = getExpectedWeight(new Date(latestEntry.date));
                const progressionDiff = currentWeight - expectedWeight;
                const progressionRate = (progressionDiff / expectedWeight * 100).toFixed(1);
                
                document.getElementById('progressionRate').textContent = (progressionDiff >= 0 ? '+' : '') + progressionRate + '%';
                document.getElementById('progressionTarget').textContent = 'Attendu: ' + expectedWeight.toFixed(1) + 'kg';
                
                let progressionProgress = 100;
                let progressionStatus = 'On track';
                let statusClass = 'status-on-track';
                
                if (currentPhase === PHASES.PHASE1) {
                    if (Math.abs(progressionDiff) <= 0.5) {
                        progressionStatus = '‚úì Parfait';
                    } else if (progressionDiff > 0.5) {
                        progressionStatus = '‚ö† Acc√©l√©rer';
                        statusClass = 'status-warning';
                        progressionProgress = 50;
                    } else {
                        progressionStatus = '‚ö† Ralentir';
                        statusClass = 'status-warning';
                        progressionProgress = 50;
                    }
                } else if (currentPhase === PHASES.PHASE3) {
                    if (Math.abs(progressionDiff) <= 0.5) {
                        progressionStatus = '‚úì Parfait';
                    } else if (progressionDiff < -0.5) {
                        progressionStatus = '‚ö† Manger plus';
                        statusClass = 'status-warning';
                        progressionProgress = 50;
                    } else {
                        progressionStatus = '‚ö† Ralentir gain';
                        statusClass = 'status-warning';
                        progressionProgress = 50;
                    }
                }
                
                document.getElementById('progressionProgress').style.width = progressionProgress + '%';
                document.getElementById('progressionStatus').textContent = progressionStatus;
                document.getElementById('progressionStatus').className = 'goal-status ' + statusClass;
                
                // Weekly progress
                const today = TEST_DATE || new Date();
                const lastWeekData = weightData.filter(e => {
                    const entryDate = new Date(e.date);
                    return (today - entryDate) <= 7 * 24 * 60 * 60 * 1000;
                }).sort((a, b) => new Date(a.date) - new Date(b.date));
                
                if (lastWeekData.length >= 2) {
                    const weeklyChange = latestEntry.weight - lastWeekData[0].weight;
                    const changeSign = weeklyChange >= 0 ? '+' : '';
                    document.getElementById('weeklyChange').textContent = changeSign + weeklyChange.toFixed(2) + 'kg';
                    
                    let weeklyProgress = 0;
                    let isOnTrack = false;
                    
                    if (currentPhase === PHASES.PHASE1) {
                        weeklyProgress = Math.min(Math.abs(weeklyChange / 0.45) * 100, 100);
                        isOnTrack = weeklyChange <= -0.4 && weeklyChange >= -0.6;
                    } else if (currentPhase === PHASES.PHASE2) {
                        weeklyProgress = Math.max(100 - Math.abs(weeklyChange / 0.2) * 100, 0);
                        isOnTrack = Math.abs(weeklyChange) <= 0.3;
                    } else {
                        weeklyProgress = Math.min((weeklyChange / 0.30) * 100, 100);
                        isOnTrack = weeklyChange >= 0.25 && weeklyChange <= 0.40;
                    }
                    
                    document.getElementById('weeklyProgress').style.width = weeklyProgress + '%';
                    
                    if (isOnTrack) {
                        document.getElementById('weeklyStatus').textContent = '‚úì Parfait';
                        document.getElementById('weeklyStatus').className = 'goal-status status-on-track';
                    } else {
                        document.getElementById('weeklyStatus').textContent = '‚ö† Ajuster';
                        document.getElementById('weeklyStatus').className = 'goal-status status-warning';
                    }
                }
                
                // Update predictions
                const predictions = calculatePredictions();
                document.getElementById('predictedFinalWeight').textContent = predictions.finalWeight;
                document.getElementById('predictedPhaseDate').textContent = predictions.phaseDate;
                document.getElementById('currentRate').textContent = predictions.rate;
                document.getElementById('daysToGoal').textContent = predictions.daysToGoal;
            }
            
            updateMainChart();
            updatePhaseChart();
            updateStrengthChart();
            updateHistory();
        }
        
        // Update main chart (6 months)
        let mainChartInstance = null;
        function updateMainChart() {
            const ctx = document.getElementById('mainChart').getContext('2d');
            
            if (mainChartInstance) {
                mainChartInstance.destroy();
            }
            
            const labels = [];
            const actualWeights = [];
            const averageWeights = [];
            const expectedWeights = [];
            
            for (let d = new Date(PHASES.PRESTART.start); d <= PHASES.PHASE3.end; d.setDate(d.getDate() + 7)) {
                const dateStr = d.toISOString().split('T')[0];
                labels.push(dateStr);
                expectedWeights.push(getExpectedWeight(new Date(dateStr)));
                
                const entry = weightData.find(e => {
                    const entryDate = new Date(e.date);
                    return Math.abs(entryDate - d) < 3.5 * 24 * 60 * 60 * 1000;
                });
                actualWeights.push(entry ? entry.weight : null);
                
                // Calculate 7-day average
                const entryIndex = weightData.findIndex(e => e.date === dateStr);
                if (entryIndex >= 0) {
                    averageWeights.push(get7DayAverage(entryIndex));
                } else {
                    averageWeights.push(null);
                }
            }
            
            mainChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Poids R√©el',
                            data: actualWeights,
                            borderColor: '#ff6b35',
                            backgroundColor: 'rgba(255, 107, 53, 0.1)',
                            borderWidth: 2,
                            pointRadius: 4,
                            pointBackgroundColor: '#ff6b35',
                            tension: 0.4,
                            spanGaps: true
                        },
                        {
                            label: 'Moyenne 7j',
                            data: averageWeights,
                            borderColor: '#ffd166',
                            backgroundColor: 'rgba(255, 209, 102, 0.05)',
                            borderWidth: 3,
                            pointRadius: 0,
                            tension: 0.4,
                            spanGaps: true
                        },
                        {
                            label: 'Objectif',
                            data: expectedWeights,
                            borderColor: '#4ecdc4',
                            backgroundColor: 'rgba(78, 205, 196, 0.05)',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 0,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#a8b2d1',
                                font: { size: 14, weight: '600' }
                            }
                        },
                        tooltip: {
                            backgroundColor: '#1a1f3a',
                            titleColor: '#ffffff',
                            bodyColor: '#a8b2d1',
                            borderColor: '#2d3561',
                            borderWidth: 1,
                            padding: 12
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: '#2d3561', drawBorder: false },
                            ticks: {
                                color: '#a8b2d1',
                                maxTicksLimit: 15,
                                callback: function(value) {
                                    const date = new Date(this.getLabelForValue(value));
                                    return date.getDate() + '/' + (date.getMonth() + 1);
                                }
                            }
                        },
                        y: {
                            grid: { color: '#2d3561', drawBorder: false },
                            ticks: {
                                color: '#a8b2d1',
                                callback: function(value) {
                                    return value.toFixed(0) + 'kg';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Update phase chart (current phase only)
        let phaseChartInstance = null;
        function updatePhaseChart() {
            const ctx = document.getElementById('phaseChart').getContext('2d');
            
            if (phaseChartInstance) {
                phaseChartInstance.destroy();
            }
            
            const currentPhase = getCurrentPhase();
            const labels = [];
            const actualWeights = [];
            const averageWeights = [];
            const expectedWeights = [];
            
            const today = new Date();
            const endDate = new Date(Math.min(today.getTime() + 7 * 24 * 60 * 60 * 1000, currentPhase.end.getTime()));
            
            for (let d = new Date(currentPhase.start); d <= endDate; d.setDate(d.getDate() + 1)) {
                const dateStr = d.toISOString().split('T')[0];
                labels.push(dateStr);
                expectedWeights.push(getExpectedWeight(new Date(dateStr)));
                
                const entry = weightData.find(e => e.date === dateStr);
                actualWeights.push(entry ? entry.weight : null);
                
                const entryIndex = weightData.findIndex(e => e.date === dateStr);
                if (entryIndex >= 0) {
                    averageWeights.push(get7DayAverage(entryIndex));
                } else {
                    averageWeights.push(null);
                }
            }
            
            phaseChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Poids R√©el',
                            data: actualWeights,
                            borderColor: '#ff6b35',
                            backgroundColor: 'rgba(255, 107, 53, 0.1)',
                            borderWidth: 3,
                            pointRadius: 5,
                            pointBackgroundColor: '#ff6b35',
                            tension: 0.4,
                            spanGaps: true
                        },
                        {
                            label: 'Moyenne 7j',
                            data: averageWeights,
                            borderColor: '#ffd166',
                            backgroundColor: 'rgba(255, 209, 102, 0.05)',
                            borderWidth: 3,
                            pointRadius: 0,
                            tension: 0.4,
                            spanGaps: true
                        },
                        {
                            label: 'Objectif',
                            data: expectedWeights,
                            borderColor: '#4ecdc4',
                            backgroundColor: 'rgba(78, 205, 196, 0.05)',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 0,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#a8b2d1',
                                font: { size: 14, weight: '600' }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: '#2d3561', drawBorder: false },
                            ticks: {
                                color: '#a8b2d1',
                                maxTicksLimit: 20,
                                callback: function(value) {
                                    const date = new Date(this.getLabelForValue(value));
                                    return date.getDate() + '/' + (date.getMonth() + 1);
                                }
                            }
                        },
                        y: {
                            grid: { color: '#2d3561', drawBorder: false },
                            ticks: {
                                color: '#a8b2d1',
                                callback: function(value) {
                                    return value.toFixed(1) + 'kg';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Update strength chart
        let strengthChartInstance = null;
        function updateStrengthChart() {
            const ctx = document.getElementById('strengthChart').getContext('2d');
            
            if (strengthChartInstance) {
                strengthChartInstance.destroy();
            }
            
            if (strengthData.length === 0) {
                return;
            }
            
            const labels = strengthData.map(e => {
                const d = new Date(e.date);
                return d.getDate() + '/' + (d.getMonth() + 1);
            });
            
            strengthChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Squat',
                            data: strengthData.map(e => e.squat),
                            borderColor: '#ff6b35',
                            backgroundColor: 'rgba(255, 107, 53, 0.1)',
                            borderWidth: 3,
                            pointRadius: 5,
                            tension: 0.4,
                            spanGaps: true
                        },
                        {
                            label: 'D√©velopp√© Inclin√©',
                            data: strengthData.map(e => e.bench),
                            borderColor: '#4ecdc4',
                            backgroundColor: 'rgba(78, 205, 196, 0.1)',
                            borderWidth: 3,
                            pointRadius: 5,
                            tension: 0.4,
                            spanGaps: true
                        },
                        {
                            label: 'Soulev√© de Terre',
                            data: strengthData.map(e => e.deadlift),
                            borderColor: '#a855f7',
                            backgroundColor: 'rgba(168, 85, 247, 0.1)',
                            borderWidth: 3,
                            pointRadius: 5,
                            tension: 0.4,
                            spanGaps: true
                        },
                        {
                            label: 'Presse',
                            data: strengthData.map(e => e.press),
                            borderColor: '#ffd166',
                            backgroundColor: 'rgba(255, 209, 102, 0.1)',
                            borderWidth: 3,
                            pointRadius: 5,
                            tension: 0.4,
                            spanGaps: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#a8b2d1',
                                font: { size: 14, weight: '600' }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: '#2d3561', drawBorder: false },
                            ticks: { color: '#a8b2d1' }
                        },
                        y: {
                            grid: { color: '#2d3561', drawBorder: false },
                            ticks: {
                                color: '#a8b2d1',
                                callback: function(value) {
                                    return value + 'kg';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Update history table
        function updateHistory() {
            const tbody = document.getElementById('historyBody');
            
            if (weightData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: var(--text-secondary);">Aucune donn√©e enregistr√©e</td></tr>';
                return;
            }
            
            tbody.innerHTML = '';
            
            for (let i = weightData.length - 1; i >= 0; i--) {
                const entry = weightData[i];
                const row = document.createElement('tr');
                
                const avg7 = get7DayAverage(i);
                const variation = i > 0 ? entry.weight - weightData[i-1].weight : 0;
                const variationClass = variation < 0 ? 'trend-down' : variation > 0 ? 'trend-up' : '';
                const variationText = variation !== 0 ? (variation > 0 ? '+' : '') + variation.toFixed(1) + 'kg' : '-';
                
                row.innerHTML = `
                    <td>${new Date(entry.date).toLocaleDateString('fr-FR')}</td>
                    <td>${entry.phase}</td>
                    <td>${entry.weight.toFixed(1)}kg</td>
                    <td>${avg7 ? avg7.toFixed(1) + 'kg' : '-'}</td>
                    <td class="${variationClass}">${variationText}</td>
                    <td>${entry.waist ? entry.waist.toFixed(1) + 'cm' : '-'}</td>
                    <td>${entry.calories > 0 ? entry.calories + 'kcal' : 'Libre'}</td>
                    <td>
                        <button class="edit-btn" onclick="editEntry('${entry.date}')">‚úèÔ∏è</button>
                        <button class="delete-btn" onclick="deleteEntry('${entry.date}')">üóëÔ∏è</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            }
        }
        
        // Chart Modal Functions
        let modalChartInstance = null;
        let currentChartType = null;
        
        function openChartModal(chartType) {
            currentChartType = chartType;
            const modal = document.getElementById('chartModal');
            const title = document.getElementById('chartModalTitle');
            
            // Set title
            if (chartType === 'main') {
                title.textContent = 'üìä √âvolution Compl√®te (6 Mois)';
            } else if (chartType === 'phase') {
                title.textContent = 'üéØ Zoom Phase Actuelle';
            } else if (chartType === 'strength') {
                title.textContent = 'üìà √âvolution des Charges';
            }
            
            modal.classList.add('active');
            
            // Render chart in modal
            setTimeout(() => {
                renderModalChart(chartType);
            }, 100);
        }
        
        function closeChartModal() {
            const modal = document.getElementById('chartModal');
            modal.classList.remove('active');
            
            if (modalChartInstance) {
                modalChartInstance.destroy();
                modalChartInstance = null;
            }
        }
        
        function renderModalChart(chartType) {
            const ctx = document.getElementById('modalChart').getContext('2d');
            
            if (modalChartInstance) {
                modalChartInstance.destroy();
            }
            
            if (chartType === 'main') {
                renderModalMainChart(ctx);
            } else if (chartType === 'phase') {
                renderModalPhaseChart(ctx);
            } else if (chartType === 'strength') {
                renderModalStrengthChart(ctx);
            }
        }
        
        function renderModalMainChart(ctx) {
            const labels = [];
            const actualWeights = [];
            const averageWeights = [];
            const expectedWeights = [];
            
            for (let d = new Date(PHASES.PRESTART.start); d <= PHASES.PHASE3.end; d.setDate(d.getDate() + 7)) {
                const dateStr = d.toISOString().split('T')[0];
                labels.push(dateStr);
                expectedWeights.push(getExpectedWeight(new Date(dateStr)));
                
                const entry = weightData.find(e => {
                    const entryDate = new Date(e.date);
                    return Math.abs(entryDate - d) < 3.5 * 24 * 60 * 60 * 1000;
                });
                actualWeights.push(entry ? entry.weight : null);
                
                const entryIndex = weightData.findIndex(e => e.date === dateStr);
                if (entryIndex >= 0) {
                    averageWeights.push(get7DayAverage(entryIndex));
                } else {
                    averageWeights.push(null);
                }
            }
            
            modalChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Poids R√©el',
                            data: actualWeights,
                            borderColor: '#ff6b35',
                            backgroundColor: 'rgba(255, 107, 53, 0.1)',
                            borderWidth: 4,
                            pointRadius: 8,
                            pointBackgroundColor: '#ff6b35',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            tension: 0.4,
                            spanGaps: true
                        },
                        {
                            label: 'Moyenne 7j',
                            data: averageWeights,
                            borderColor: '#ffd166',
                            backgroundColor: 'rgba(255, 209, 102, 0.05)',
                            borderWidth: 4,
                            pointRadius: 0,
                            tension: 0.4,
                            spanGaps: true
                        },
                        {
                            label: 'Objectif',
                            data: expectedWeights,
                            borderColor: '#4ecdc4',
                            backgroundColor: 'rgba(78, 205, 196, 0.05)',
                            borderWidth: 3,
                            borderDash: [8, 8],
                            pointRadius: 0,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: window.innerWidth < 768 ? 1 : 2.5,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#a8b2d1',
                                font: { size: 18, weight: '600' },
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            backgroundColor: '#1a1f3a',
                            titleColor: '#ffffff',
                            bodyColor: '#a8b2d1',
                            borderColor: '#2d3561',
                            borderWidth: 1,
                            padding: 16,
                            titleFont: { size: 16, weight: 'bold' },
                            bodyFont: { size: 15 },
                            displayColors: true,
                            boxPadding: 6
                        }
                    },
                    scales: {
                        x: {
                            grid: { 
                                color: '#2d3561', 
                                drawBorder: false,
                                lineWidth: 1
                            },
                            ticks: {
                                color: '#a8b2d1',
                                font: { size: 14 },
                                maxTicksLimit: window.innerWidth < 768 ? 8 : 15,
                                padding: 10,
                                callback: function(value) {
                                    const date = new Date(this.getLabelForValue(value));
                                    return date.getDate() + '/' + (date.getMonth() + 1);
                                }
                            }
                        },
                        y: {
                            grid: { 
                                color: '#2d3561', 
                                drawBorder: false,
                                lineWidth: 1
                            },
                            ticks: {
                                color: '#a8b2d1',
                                font: { size: 15, weight: '600' },
                                padding: 10,
                                callback: function(value) {
                                    return value.toFixed(0) + 'kg';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function renderModalPhaseChart(ctx) {
            const currentPhase = getCurrentPhase();
            const labels = [];
            const actualWeights = [];
            const averageWeights = [];
            const expectedWeights = [];
            
            const today = new Date();
            const endDate = new Date(Math.min(today.getTime() + 7 * 24 * 60 * 60 * 1000, currentPhase.end.getTime()));
            
            for (let d = new Date(currentPhase.start); d <= endDate; d.setDate(d.getDate() + 1)) {
                const dateStr = d.toISOString().split('T')[0];
                labels.push(dateStr);
                expectedWeights.push(getExpectedWeight(new Date(dateStr)));
                
                const entry = weightData.find(e => e.date === dateStr);
                actualWeights.push(entry ? entry.weight : null);
                
                const entryIndex = weightData.findIndex(e => e.date === dateStr);
                if (entryIndex >= 0) {
                    averageWeights.push(get7DayAverage(entryIndex));
                } else {
                    averageWeights.push(null);
                }
            }
            
            modalChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Poids R√©el',
                            data: actualWeights,
                            borderColor: '#ff6b35',
                            backgroundColor: 'rgba(255, 107, 53, 0.1)',
                            borderWidth: 4,
                            pointRadius: 8,
                            pointBackgroundColor: '#ff6b35',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            tension: 0.4,
                            spanGaps: true
                        },
                        {
                            label: 'Moyenne 7j',
                            data: averageWeights,
                            borderColor: '#ffd166',
                            backgroundColor: 'rgba(255, 209, 102, 0.05)',
                            borderWidth: 4,
                            pointRadius: 0,
                            tension: 0.4,
                            spanGaps: true
                        },
                        {
                            label: 'Objectif',
                            data: expectedWeights,
                            borderColor: '#4ecdc4',
                            backgroundColor: 'rgba(78, 205, 196, 0.05)',
                            borderWidth: 3,
                            borderDash: [8, 8],
                            pointRadius: 0,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: window.innerWidth < 768 ? 1 : 2.5,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#a8b2d1',
                                font: { size: 18, weight: '600' },
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            backgroundColor: '#1a1f3a',
                            titleColor: '#ffffff',
                            bodyColor: '#a8b2d1',
                            borderColor: '#2d3561',
                            borderWidth: 1,
                            padding: 16,
                            titleFont: { size: 16, weight: 'bold' },
                            bodyFont: { size: 15 },
                            displayColors: true,
                            boxPadding: 6
                        }
                    },
                    scales: {
                        x: {
                            grid: { 
                                color: '#2d3561', 
                                drawBorder: false,
                                lineWidth: 1
                            },
                            ticks: {
                                color: '#a8b2d1',
                                font: { size: 14 },
                                maxTicksLimit: window.innerWidth < 768 ? 8 : 20,
                                padding: 10,
                                callback: function(value) {
                                    const date = new Date(this.getLabelForValue(value));
                                    return date.getDate() + '/' + (date.getMonth() + 1);
                                }
                            }
                        },
                        y: {
                            grid: { 
                                color: '#2d3561', 
                                drawBorder: false,
                                lineWidth: 1
                            },
                            ticks: {
                                color: '#a8b2d1',
                                font: { size: 15, weight: '600' },
                                padding: 10,
                                callback: function(value) {
                                    return value.toFixed(1) + 'kg';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function renderModalStrengthChart(ctx) {
            if (strengthData.length === 0) {
                return;
            }
            
            const labels = strengthData.map(e => {
                const d = new Date(e.date);
                return d.getDate() + '/' + (d.getMonth() + 1);
            });
            
            modalChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Squat',
                            data: strengthData.map(e => e.squat),
                            borderColor: '#ff6b35',
                            backgroundColor: 'rgba(255, 107, 53, 0.1)',
                            borderWidth: 4,
                            pointRadius: 8,
                            pointBackgroundColor: '#ff6b35',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            tension: 0.4,
                            spanGaps: true
                        },
                        {
                            label: 'D√©velopp√© Inclin√©',
                            data: strengthData.map(e => e.bench),
                            borderColor: '#4ecdc4',
                            backgroundColor: 'rgba(78, 205, 196, 0.1)',
                            borderWidth: 4,
                            pointRadius: 8,
                            pointBackgroundColor: '#4ecdc4',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            tension: 0.4,
                            spanGaps: true
                        },
                        {
                            label: 'Soulev√© de Terre',
                            data: strengthData.map(e => e.deadlift),
                            borderColor: '#a855f7',
                            backgroundColor: 'rgba(168, 85, 247, 0.1)',
                            borderWidth: 4,
                            pointRadius: 8,
                            pointBackgroundColor: '#a855f7',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            tension: 0.4,
                            spanGaps: true
                        },
                        {
                            label: 'Presse',
                            data: strengthData.map(e => e.press),
                            borderColor: '#ffd166',
                            backgroundColor: 'rgba(255, 209, 102, 0.1)',
                            borderWidth: 4,
                            pointRadius: 8,
                            pointBackgroundColor: '#ffd166',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            tension: 0.4,
                            spanGaps: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: window.innerWidth < 768 ? 1 : 2.5,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#a8b2d1',
                                font: { size: 18, weight: '600' },
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            backgroundColor: '#1a1f3a',
                            titleColor: '#ffffff',
                            bodyColor: '#a8b2d1',
                            borderColor: '#2d3561',
                            borderWidth: 1,
                            padding: 16,
                            titleFont: { size: 16, weight: 'bold' },
                            bodyFont: { size: 15 },
                            displayColors: true,
                            boxPadding: 6
                        }
                    },
                    scales: {
                        x: {
                            grid: { 
                                color: '#2d3561', 
                                drawBorder: false,
                                lineWidth: 1
                            },
                            ticks: { 
                                color: '#a8b2d1',
                                font: { size: 14 },
                                padding: 10
                            }
                        },
                        y: {
                            grid: { 
                                color: '#2d3561', 
                                drawBorder: false,
                                lineWidth: 1
                            },
                            ticks: {
                                color: '#a8b2d1',
                                font: { size: 15, weight: '600' },
                                padding: 10,
                                callback: function(value) {
                                    return value + 'kg';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Initialize
        updateDashboard();
    </script>
</body>
</html>